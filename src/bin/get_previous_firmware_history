#!/bin/sh

source $HATHOR/config/basic_config
source $HATHOR/lib/libfirmwareinfo

WARN='\033[33;01m'
NORMAL='\033[0m'

[ -f "$FIRMWARE_CONFIG" ] && source $FIRMWARE_CONFIG
hathor_get_firmware_path

#FIRMWARE_PATH_SERVER_REVERTED=`echo "$FIRMWARE_PATH_SERVER" | sed -e 's:\\\\:\/:g'`
#HATHOR_FIRMWARE_PATH_PREFIX_REVERTED=`echo $HATHOR_FIRMWARE_PATH_PREFIX | sed -e 's:\\\\:\/:g'`
[ -f "$HISTORY_ATHENA" ] && rm -f "$HISTORY_ATHENA"

echo ""
echo -e "Get previous history.txt from Athena"
echo -e "Please input athena password:"
echo -e "$WARN密碼錯誤重試次數只有 3 次，請小心輸入$NORMAL"
for i in `seq 1 3`; do
	smbclient "$FIRMWARE_PATH_SERVER_REVERTED" -U $USERNAME_ATHENA -D "$HATHOR_FIRMWARE_PATH_PREFIX_REVERTED" -c "get history.txt" 2> /dev/null
	smbclient_result=$?
	if [ "$smbclient_result" = "0" ]; then
		# smbclient connect success
		break
	fi
	echo "Unable to retrieve history.txt from athena, retry $i"
done
dos2unix history.txt 2> /dev/null
mv history.txt $HISTORY_ATHENA

