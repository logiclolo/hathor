#!/bin/sh

source $HATHOR/config/basic_config
source $HATHOR/lib/libfirmwarerelease

set +o posix
TEMP_PRODUCT_DIR="$TEMP_DIR/$PRODUCTVER"
DEVEL_SOURCE_FILE="devel_`echo $PRODUCTVER | sed -e 's/-[^-]*$//' -e 's/-/_/g'`"
if [ -e "$TEMP_PRODUCT_DIR/build/apps_config.config" ]; then
	source $TEMP_PRODUCT_DIR/build/apps_config.config
elif [ -e "$TEMP_PRODUCT_DIR/release/config/apps_config.config" ]; then
	source $TEMP_PRODUCT_DIR/release/config/apps_config.config
else
	echo "$0: Where to find apps_config.config?"
	exit 1
fi
cd $TEMP_PRODUCT_DIR/build/
source $DEVEL_SOURCE_FILE

# create product dir if it doesn't exist
[ -d "$RELEASE_DIR" ] || mkdir $RELEASE_DIR

# copy firmware .pkg, .rom
copy_firmware
echo "Firmware copied (${PRODUCTVER})."

copy_history

# copy rootfs/flashfs log
copy_filesystem_log
